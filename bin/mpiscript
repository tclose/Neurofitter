#!/bin/bash

# Send mail at begin and end of job
#$ -M werner@tnb.ua.ac.be
#$ -m bae

#$ -l arch=g5
#$ -j y

#$ -o /cluster/home/werner/joboutputs

#$ -q normal.q 
#$ -pe mpichtight 5

#$ -v MPICH_HOME=/cluster/sw/mpich,SGE_QMASTER_PORT

HOME=/cluster/home/werner


###################################################
### Copy the model to all machines we are using ###
###################################################
#rshcmd=/Library/GridEngine/mpi/rsh
rshcmd=/usr/bin/ssh

scratch=/cluster/scratch/local/$USER/genesisoutput
#sort -u -o ./Machinelist $TMPDIR/machines 

for machine in `sort -u $TMPDIR/machines`; 
do
  echo $machine;
  $rshcmd $machine mkdir -p $scratch;
  $rshcmd $machine cp -r $homedir/EvolufitWork/wernermodel $scratch;
done;


#LOCALFILE=/cluster/scratch/local/werner/output_$JOB_ID.dat

#LOCALGENESISOUTPUT=/cluster/scratch/local/werner/genesisoutput

#mkdir $LOCALGENESISOUTPUT

#ln -s $LOCALGENESISOUTPUT $HOME/EvolufitWork/wernermodel/outputfiles

#/cluster/sw/mpich/bin/mpirun -machinefile $TMPDIR/machines -np $NSLOTS $HOME/EvolufitWork/Evolufit/bin/MPIEvolufitScript

#for machine in `sort -u $TMPDIR/machines`;
#do
#  echo $machine
  #$rshcmd $machine rm -rf $scratch
#done;

#cp $LOCALFILE $HOME/output

#rm -rf $LOCALGENESISOUTPUT
#rm $LOCALFILE

# END

